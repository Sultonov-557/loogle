<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              base: {
                DEFAULT: "#24273A",
                100: "#363A4F",
                200: "#494D64",
              },
              overlay: "#1E2030",
              text: {
                DEFAULT: "#CAD3F5",
                muted: "#A5ADCB",
                accent: "#8AADF4",
                highlight: "#F5A97F",
              },
              accent: {
                blue: "#8AADF4",
                peach: "#F5A97F",
                green: "#A6DA95",
                yellow: "#EED49F",
              },
            },
            fontFamily: {
              sans: ["Inter", "sans-serif"],
            },
            fontSize: {
              base: "16px",
              sm: "14px",
              md: "18px",
              lg: "20px",
              xl: "24px",
              "2xl": "28px",
              "3xl": "32px",
              "4xl": "36px",
              "5xl": "40px",
              "6xl": "44px",
            },
            animation: {
              fadeIn: "fadeIn 0.5s ease-out",
              slideUp: "slideUp 0.5s ease-out",
            },
            keyframes: {
              fadeIn: {
                from: { opacity: "0" },
                to: { opacity: "1" },
              },
              slideUp: {
                from: { transform: "translateY(10px)", opacity: "0" },
                to: { transform: "translateY(0)", opacity: "1" },
              },
            },
          },
        },
      };
    </script>
  </head>
  <body class="flex items-center justify-center bg-base text-text min-h-screen">
    <div class="max-w-7xl w-full p-6 bg-overlay rounded-lg shadow-lg gap-6 flex flex-col items-center">
      <!-- Logo -->
      <img src="/logo.png" alt="Logo" class="h-32 mb-4" />
      <!-- Main Content -->
      <div class="flex-1 animate-fadeIn w-full">
        <div class="mb-4">
          <input
            id="search_input"
            type="text"
            class="w-full h-12 bg-base-200 rounded-md p-4 text-lg text-text-muted focus:outline-none focus:ring focus:ring-accent-blue placeholder-text-muted transition-all duration-300"
            placeholder="Search..."
          />
        </div>
        <div id="search_time" class="text-text-muted text-sm mb-4 animate-slideUp"></div>
        <div
          id="search_results"
          class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 animate-slideUp"
        ></div>

        <div id="pagination" class="flex justify-center items-center mt-4"></div>
      </div>
    </div>

    <script>
      const searchInput = document.querySelector("#search_input");
      const searchResults = document.querySelector("#search_results");
      const searchTime = document.querySelector("#search_time");
      const pagination = document.querySelector("#pagination");

      searchInput.onchange = async () => {
        await search(searchInput.value);
      };

      window.onload = () => {
        const pathname = window.location.pathname.split("").splice(1).join("");
        if (pathname !== "") {
          search(pathname);
          searchInput.value = pathname;
        }
      };

      async function search(input, page = 1) {
        history.pushState({}, null, `/${input}`);
        if (input == "") {
          pagination.innerHTML = "";
          searchResults.innerHTML = "";
          searchTime.innerHTML = "";
          return;
        }
        const req = await fetch(`./search/${searchInput.value}?page=${page}`);
        const body = await req.json();
        const results = body.data.map((result, index) => {
          const faviconUrl = `https://www.google.com/s2/favicons?sz=64&domain_url=${new URL(result.url).origin}`;
          const descriptionContent = result.description
            ? `<p class="text-text-muted text-sm mt-2 truncate">${result.description}</p>`
            : Object.keys(result.headers)
                .map(
                  (headerType) =>
                    `<p class="text-text-muted text-sm truncate">${result.headers[headerType].join(", ")}</p>`
                )
                .join("");

          return `<div class="p-6 border border-base-200 rounded-md bg-base hover:bg-base-200 transition-all shadow-lg hover:shadow-2xl cursor-pointer"
                      onclick="updateSidebar(${index})">
                      <a href="/click/${result.id || result.ID}" class="flex items-center space-x-4 hover:underline">
                        <img src="${faviconUrl}" alt="favicon" class="w-8 h-8 rounded" />
                        <span class="text-lg font-semibold text-accent-blue hover:text-accent-green">
                          ${result.title}
                        </span>
                      </a>
                      ${descriptionContent}
                    </div>`;
        });

        searchResults.innerHTML = results.join("");
        searchTime.innerHTML = `Search time: <span class="font-semibold text-accent-yellow">${body.time}ms</span>`;

        // Pagination
        const totalPages = body.total;
        let paginationButtons = "";
        for (let i = 1; i <= totalPages; i++) {
          paginationButtons += `<button class="mx-1 px-3 py-1 rounded bg-base-200 hover:bg-accent-yellow hover:text-white transition-all text-text-muted text-lg font-semibold" onclick="search('${input}', ${i})">${i}</button>`;
        }
        pagination.innerHTML = paginationButtons;
      }
    </script>
  </body>
</html>
